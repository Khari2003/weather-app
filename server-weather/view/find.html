<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Search</title>
    <style>
        #result {
            margin-top: 10px;
        }
        .forecast {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <input type="text" id="name" placeholder="Enter city name">
    <button onclick="searchCity()">Find</button>

    <div id="result"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        async function searchCity() {
            const city = $('#name').val();
            try {
                const res = await $.ajax({
                    url: `/api/search?name=${encodeURIComponent(city)}`, // Use "name" to match backend
                    type: 'GET',
                });
    
                // Extract city name, using Vietnamese or English as fallback
                const cityName = res.local_names?.vi || res.local_names?.en || city;
                const { temp, humidity, wind_speed, dew_point, pressure, uvi, visibility, feels_like } = res.current;
                const highTemp = Math.round(res.daily[0].temp.max);
                const lowTemp = Math.round(res.daily[0].temp.min);
                const weatherDescription = res.daily[0].weather[0].description;
    
                // AQI (Air Quality Index)
                const aqi = res.aqi;
    
                // Generate HTML content for current weather
                let htmlContent = `
                    <h3>Weather in ${cityName}</h3>
                    <p><strong>Description:</strong> ${weatherDescription}</p>
                    <p><strong>Current Temperature:</strong> ${temp}°C</p>
                    <p><strong>High:</strong> ${highTemp}°C, <strong>Low:</strong> ${lowTemp}°C</p>
                    <p><strong>Humidity:</strong> ${humidity}%</p>
                    <p><strong>Wind Speed:</strong> ${wind_speed} m/s</p>
                    <p><strong>Visibility:</strong> ${visibility} meters</p>
                    <p><strong>Air Quality Index (AQI):</strong> ${aqi}</p>
                `;
    
                // Hourly forecast
                htmlContent += `<div class="forecast"><h4>24-Hour Forecast</h4>`;
                res.hourly.slice(0, 24).forEach((hour, index) => {
                    htmlContent += `<p>Hour ${index + 1}: ${Math.round(hour.temp)}°C, ${hour.weather[0].description}</p>`;
                });
                htmlContent += `</div>`;
    
                // Weekly forecast
                htmlContent += `<div class="forecast"><h4>7-Day Forecast</h4>`;
                res.daily.slice(0, 7).forEach((day, index) => {
                    htmlContent += `<p>Day ${index + 1}: High ${Math.round(day.temp.max)}°C, Low ${Math.round(day.temp.min)}°C, ${day.weather[0].description}</p>`;
                });
                htmlContent += `</div>`;
    
                $('#result').html(htmlContent);
            } catch (error) {
                console.error('Error fetching weather data:', error);
                $('#result').html('<p style="color: red;">Error fetching weather data. Please try again.</p>');
            }
        }
    </script>    
</body>
</html>
